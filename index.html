<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<style >
		body{
			margin: 0;
			word-wrap: break-word;
			word-break: break-all;
		}
		.title{
			padding: 0.2rem 0.26rem;
			font-size:  0.32rem;
		}
		.description{
			margin: 0 0.26rem;
			font-size:  0.26rem;
			color: #777;
			padding-bottom: 0.2rem;
			border-bottom: 1px solid #ebebeb;
		}
		.rich-text{
			margin: 0.3rem 0.26rem;
			font-size: 0.29rem;
			color: #888;
		}
		#function{
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding:0 0.46rem 0.34rem;
		}
		.btn{
			width: 1.4rem;
			text-align: center;
			font-size: 0.26rem;
		}
		.btn img{
			width: 0.42rem;
			height: 0.42rem;
		}
		#review{
			border-top: 0.3rem #f5f5f5 solid;
		}
		.label-title{
			position: relative;
			font-size: 0.32rem;
			line-height: 0.88rem;
			padding-left: 0.56rem;
		}
		.label-title::after{
			position: absolute;
			content: ' ';
			display: inline-block;
			height: 0.34rem;
			width: 0.08rem;
			border-radius: 0.08rem;
			background: #33C633;
			left: 0.26rem;
			top: 0.28rem;
		}
		.list{
			margin-left: 0.26rem;
			padding-right: 0.26rem;
			border-bottom: 1px solid #EBEBEB;
			
		}
		.avatars{
			border-radius: 50%;
			width: 0.8rem;
			height: 0.8rem;
			margin-right: 0.2rem;
		}
		.case-info{
			display: flex;
			justify-content: space-between;
		}
		.name-time{
			display: flex;
			justify-content: space-between;
			font-size: 0.3rem;
			min-height: 0.8rem;
			align-items: center;
			color: #444;
		}
		.content{
			margin-top: 0.14rem;
			font-size: 0.32rem;
		}
		.function{
			padding: 0.24rem 0;
			display: flex;
			align-items: center;
			flex-direction: row-reverse;
			font-size: 0.26rem;
		}
		.function img{
			width: 0.36rem;
			height: 0.36rem;
			margin-right: 0.08rem;
		}
		.function img:nth-child(1){
			margin-left: 0.34rem;
		}
		#input-fixed{
			box-shadow: 0 0 0.12rem 0 #777777 ;
			display: flex;
			justify-content: space-between;
			align-items: center;
			font-size: 0.28rem;
			position: fixed;
			bottom: 0;
			left: 0;
			width: 100%;
			height: 1.1rem;
			background: #fff;
			z-index: 1;
		}
		.input{
			line-height: 0.78rem ;
			margin-left: 0.3rem;
			flex-grow: 1;
			background: #f5f5f5;
			border-radius: 0.44rem;
			color: #777;
			padding-left: 0.4rem;
		}
		.input-btn{
			text-align: center;
			width: 1.46rem;
		}
		.seize-bottom{
			height: 1.2rem;
		}
		.main-info{
			width: 100%;
		}
		.video{
			object-fit: contain;
			width: calc(100% - 0.52rem);
			margin:0.16rem 0.26rem;
		}
		.pic-case{
			margin:0.16rem 0.26rem;
			display: flex;
			flex-wrap: wrap;
		}
		.pic-case img:not(.onlyOne){
			width: 32%;
			margin-left: 2%;
			margin-bottom: 0.13rem;
		}
		.pic-case img:nth-child(3n+1):not(.onlyOne){
			margin-left: 0;
		}
		.onlyOne{
			width: 100%;
		}
		#download-btn{
			position: fixed;
			z-index:2 ;
			display: inline-block;
			left: -5%;
			top: -5%;
			width: 110%;
			height: 110%;
		}
	</style>
  </head>
  <script type="text/javascript">
  	var deviceWidth = document.documentElement.clientWidth;
  	    // var deviceWidth = window.screen.availWidth
  	    // alert(navigator.userAgent)
  	    // alert(deviceWidth)
  	    // console.log(navigator.userAgent)
  	    if(deviceWidth > 750) {
  	        // deviceWidth = 750;
  	        deviceWidth = 7.5 * 50;
  	    }
  	
  	    document.documentElement.style.fontSize = deviceWidth / 7.5 + 'px';
  </script>
  <body>
	  <a id="download-btn" href="http://fir.ysxapp.com/yvpc"></a>
	<div class="title">
		
	</div>
	<div class="description">
		
	</div>
	<div id="case-video">
		
	</div>
	
	<div class="rich-text">
	</div>
	<!-- <div class="pic-case">
		
		<img class="onlyOne" src="218375433_2_20210324092538284.png" >
	</div> -->
	<div id="function">
		<div class="btn">
			<img src="./star_1.png" >
			<br />
			<span class="zan_num"></span> 人点赞
		</div>
		<div class="btn">
			<img src="./stars.png" >
			<br />
			收藏
		</div>
		<div class="btn">
			<img src="./share.png" >
			<br />
			分享
		</div>
	</div>
	<div id="review">
		
	</div>
	<div class="seize-bottom"></div>
	<div id="input-fixed">
		<div class="input">
			请输入您的评论
		</div>
		<div class="input-btn">
			评论
		</div>
	</div>
  </body>
  <script type="text/javascript">
  	function ajaxFunc(method,url,data,callback,flag=true) {
  	    var xhr = null;
  	    if (window.XMLHttpRequest) {
  	        xhr = new XMLHttpRequest();
  	    } else if (window.ActiveXObject) {
  	        //兼容IE浏览器
  	        xhr = new ActiveXObject("Microsoft.XMLHttp");
  	    }
  	    //防止请求方式输入小写
  	    method = method.toUpperCase();
  	    if (method == "GET") {
  	        //初始化
  	        xhr.open(method, url + '?' +data , flag);
  	        //发送请求
  	        xhr.send();
  	    } else if (method == "POST") {
  	        xhr.open(method, url, flag);
  	        xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
  	        xhr.send(data);
  	    }
  	    //判断数据是否回来,请求是否成功
  	    xhr.onreadystatechange = function () {
  	        if (xhr.readyState === 4) {
  	            if (xhr.status == 200) {
  	                var backData = xhr.responseText;
					try{
						callback(JSON.parse(backData).data);
					}catch(e){
						console.log(e)
						//TODO handle the exception
					}
  	            }
  	        }
  	    }
  	}
	function getSearchString(key, Url) {
	    var str = Url;
	    str = str.substring(1, str.length); // 获取URL中?之后的字符（去掉第一位的问号）
	    // 以&分隔字符串，获得类似name=xiaoli这样的元素数组
	    var arr = str.split("&");
	    var obj = new Object();
	    // 将每一个数组元素以=分隔并赋给obj对象
	    for (var i = 0; i < arr.length; i++) {
	        var tmp_arr = arr[i].split("=");
	        obj[decodeURIComponent(tmp_arr[0])] = decodeURIComponent(tmp_arr[1]);
	    }
	    return obj[key];
	}
	const uid = getSearchString('id', window.location.search); //结果：2
	
	ajaxFunc('GET','http://127.0.3.22:8070/api/index/showDetail','id='+uid,function(e){
		document.getElementsByClassName('title')[0].innerText=e.title
		document.getElementsByClassName('description')[0].innerText= e.tag?(e.tag + '  ' + (e.num||0) + '阅读' ):((e.num||0) + ' 阅读')
		e.content= e.content.replace(/<\s?img/g, "<img style='width:100%'")
			.replace(/<img\sstyle='width:100%'(.*?)width=['|"](.*?)['|"](.*?)>/g,
				"<img style='width:100%'$1$3>")
			.replace(/<img\sstyle='width:100%'(.*?)height=['|"](.*?)['|"](.*?)>/g,
				"<img style='width:100%'$1$3>")
		if(e.file){
			document.getElementById('case-video').innerHTML = `
				<video class="video" src="${item.file}" controls="controls">
					your browser does not support the video tag
				</video>
			`
		}		
		document.getElementsByClassName('rich-text')[0].innerHTML=e.content
		document.getElementsByClassName('zan_num')[0].innerText=e.zan||0
	})
	ajaxFunc('GET','http://127.0.3.22:8070/api/index/showSol','nid='+uid+'&page=1',function(e){
		console.log(1)
		let dom=`<div class="label-title">
			评论
		</div>`;
		
		for (let index in e.data){
			const item = e.data[index];
			dom += `
				<div class="list">
					<div class="case-info">
						<img src="${item.pic}" class="avatars">
						<div class="main-info">
							<div class="name-time">
								${item.name}
								<div class="time">
									${item.addtime.slice(5,)}
								</div>
							</div>
							<div class="content">
								${item.pl}
							</div>
						</div>
					</div>
					<div class="function">
						回复<img src="./returnValue.png" >${item.zan} <img src="star_2.png" >
					</div>
				</div>
			`
		}
		console.log(dom)
		document.getElementById('review').innerHTML=dom
	})
  </script>
</html>
